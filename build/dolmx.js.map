{"version":3,"file":"dolmx.js","sources":["../src/main.js"],"sourcesContent":["function trimStr(str) {\n  return (str || '').replace(/^([^\\w]|\\s)+/g, '').replace(/([^\\w]|\\s)+$/g, '')\n}\n\nfunction trimQuote(str) {\n  return trimStr(str).replace(/^(\"|')(.*)\\1$/, '$2');\n}\n\nfunction formatAttr(attr) {\n  let attrObj = {};\n  trimStr(attr).split(/['\"]\\s+/).map(item => {\n    item = trimStr(item);\n    if (!item) return;\n    let tmp = item.split(/=['\"]/);\n    let key = trimStr(tmp[0]);\n    if (!key) return;\n    attrObj[key] = trimQuote(tmp[1]) || true;\n  });\n  return attrObj;\n}\n\nexport default function dolmx(xmlstr) {\n  let reg = /^<\\??([a-z][\\w\\.\\-]*)(\\s[^>]*?)?[\\/\\?]>|^<([a-z][\\w\\.\\-]*)(\\s.*?)?>((?:(?!<\\3).)*)<\\/\\3>|^<([\\w\\-]+)(\\s+.*?)?>((?:<\\6.*?<\\/\\6>|<\\6[^>]*?\\/>|(?:(?!<\\6).)*)*)<\\/\\6>/igm,\n      isValueReg = /^<!\\[CDATA\\[(.*?)\\]\\]>$/im,\n      mached,\n      key,\n      child,\n      result = {};\n\n  xmlstr = xmlstr.replace(/\\s*\\n+\\s*/gm, '');\n\n  if (!/^</.test(xmlstr)) return { _value: xmlstr };\n\n  if (isValueReg.test(xmlstr)) return { _value: xmlstr.replace(isValueReg, '$1') };\n\n  while(mached = reg.exec(xmlstr)) {\n    xmlstr = xmlstr.substring(0, mached.index) + xmlstr.substring(mached.index +  mached[0].length);\n    reg.lastIndex = 0;\n\n    if (mached[1]) {\n      key = trimStr(mached[1]);\n      child = { _attr: formatAttr(mached[2]) };\n    } else if (mached[3]) {\n      key = trimStr(mached[3]);\n      child = {};\n      if (mached[5]) child = dolmx(mached[5]);\n      child._attr = formatAttr(mached[4]);\n    } else if (mached[6]) {\n      key = trimStr(mached[6]);\n      child = {};\n      if (mached[8]) child = dolmx(mached[8]);\n      child._attr = formatAttr(mached[7]);\n    }\n    if (result[key]) {\n      if (!Array.isArray(result[key])) {\n        result[key] = [result[key]];\n      }\n      result[key].push(child);\n    } else {\n      result[key] = child;\n    }\n  }\n  return result;\n}"],"names":["trimStr","str","replace","trimQuote","formatAttr","attr","attrObj","split","map","item","tmp","key","dolmx","xmlstr","reg","isValueReg","mached","child","result","test","_value","exec","substring","index","length","lastIndex","_attr","Array","isArray","push"],"mappings":";;;;;;;;;;;EAAA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;EACpB,SAAO,CAACA,OAAO,EAAR,EAAYC,OAAZ,CAAoB,eAApB,EAAqC,EAArC,EAAyCA,OAAzC,CAAiD,eAAjD,EAAkE,EAAlE,CAAP;EACD;;EAED,SAASC,SAAT,CAAmBF,GAAnB,EAAwB;EACtB,SAAOD,QAAQC,GAAR,EAAaC,OAAb,CAAqB,eAArB,EAAsC,IAAtC,CAAP;EACD;;EAED,SAASE,UAAT,CAAoBC,IAApB,EAA0B;EACxB,MAAIC,UAAU,EAAd;EACAN,UAAQK,IAAR,EAAcE,KAAd,CAAoB,SAApB,EAA+BC,GAA/B,CAAmC,gBAAQ;EACzCC,WAAOT,QAAQS,IAAR,CAAP;EACA,QAAI,CAACA,IAAL,EAAW;EACX,QAAIC,MAAMD,KAAKF,KAAL,CAAW,OAAX,CAAV;EACA,QAAII,MAAMX,QAAQU,IAAI,CAAJ,CAAR,CAAV;EACA,QAAI,CAACC,GAAL,EAAU;EACVL,YAAQK,GAAR,IAAeR,UAAUO,IAAI,CAAJ,CAAV,KAAqB,IAApC;EACD,GAPD;EAQA,SAAOJ,OAAP;EACD;;AAED,EAAe,SAASM,KAAT,CAAeC,MAAf,EAAuB;EACpC,MAAIC,MAAM,uKAAV;EAAA,MACIC,aAAa,2BADjB;EAAA,MAEIC,eAFJ;EAAA,MAGIL,YAHJ;EAAA,MAIIM,cAJJ;EAAA,MAKIC,SAAS,EALb;;EAOAL,WAASA,OAAOX,OAAP,CAAe,aAAf,EAA8B,EAA9B,CAAT;;EAEA,MAAI,CAAC,KAAKiB,IAAL,CAAUN,MAAV,CAAL,EAAwB,OAAO,EAAEO,QAAQP,MAAV,EAAP;;EAExB,MAAIE,WAAWI,IAAX,CAAgBN,MAAhB,CAAJ,EAA6B,OAAO,EAAEO,QAAQP,OAAOX,OAAP,CAAea,UAAf,EAA2B,IAA3B,CAAV,EAAP;;EAE7B,SAAMC,SAASF,IAAIO,IAAJ,CAASR,MAAT,CAAf,EAAiC;EAC/BA,aAASA,OAAOS,SAAP,CAAiB,CAAjB,EAAoBN,OAAOO,KAA3B,IAAoCV,OAAOS,SAAP,CAAiBN,OAAOO,KAAP,GAAgBP,OAAO,CAAP,EAAUQ,MAA3C,CAA7C;EACAV,QAAIW,SAAJ,GAAgB,CAAhB;;EAEA,QAAIT,OAAO,CAAP,CAAJ,EAAe;EACbL,YAAMX,QAAQgB,OAAO,CAAP,CAAR,CAAN;EACAC,cAAQ,EAAES,OAAOtB,WAAWY,OAAO,CAAP,CAAX,CAAT,EAAR;EACD,KAHD,MAGO,IAAIA,OAAO,CAAP,CAAJ,EAAe;EACpBL,YAAMX,QAAQgB,OAAO,CAAP,CAAR,CAAN;EACAC,cAAQ,EAAR;EACA,UAAID,OAAO,CAAP,CAAJ,EAAeC,QAAQL,MAAMI,OAAO,CAAP,CAAN,CAAR;EACfC,YAAMS,KAAN,GAActB,WAAWY,OAAO,CAAP,CAAX,CAAd;EACD,KALM,MAKA,IAAIA,OAAO,CAAP,CAAJ,EAAe;EACpBL,YAAMX,QAAQgB,OAAO,CAAP,CAAR,CAAN;EACAC,cAAQ,EAAR;EACA,UAAID,OAAO,CAAP,CAAJ,EAAeC,QAAQL,MAAMI,OAAO,CAAP,CAAN,CAAR;EACfC,YAAMS,KAAN,GAActB,WAAWY,OAAO,CAAP,CAAX,CAAd;EACD;EACD,QAAIE,OAAOP,GAAP,CAAJ,EAAiB;EACf,UAAI,CAACgB,MAAMC,OAAN,CAAcV,OAAOP,GAAP,CAAd,CAAL,EAAiC;EAC/BO,eAAOP,GAAP,IAAc,CAACO,OAAOP,GAAP,CAAD,CAAd;EACD;EACDO,aAAOP,GAAP,EAAYkB,IAAZ,CAAiBZ,KAAjB;EACD,KALD,MAKO;EACLC,aAAOP,GAAP,IAAcM,KAAd;EACD;EACF;EACD,SAAOC,MAAP;EACD;;;;;;;;"}